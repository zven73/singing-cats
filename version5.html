<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SENTIENT: FINAL FORM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --bg-void: #020205;
            --neon-cyan: #00f3ff;
            --neon-pink: #ff0055;
            --neon-acid: #ccff00;
            --glass-surface: rgba(255, 255, 255, 0.02);
            --glass-edge: rgba(255, 255, 255, 0.08);
        }

        body {
            margin: 0;
            height: 100vh;
            background-color: var(--bg-void);
            color: white;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            user-select: none;
            cursor: crosshair;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- –í–ò–ó–£–ê–õ–¨–ù–û–ï –Ø–î–†–û (CANVAS) --- */
        #art-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            filter: blur(1px) contrast(1.2);
        }

        /* --- –ü–û–°–¢-–û–ë–†–ê–ë–û–¢–ö–ê --- */
        .vignette {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 0%, #000 110%);
            pointer-events: none;
            z-index: 1;
        }

        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(to bottom,
                    transparent 0px,
                    transparent 2px,
                    rgba(0, 0, 0, 0.3) 2px,
                    rgba(0, 0, 0, 0.3) 4px);
            pointer-events: none;
            z-index: 2;
            opacity: 0.4;
        }

        /* --- UI –ö–û–ù–¢–ï–ô–ù–ï–† --- */
        .interface-layer {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 4vh 0;
            box-sizing: border-box;
            perspective: 1000px;
        }

        /* --- –°–¢–ê–¢–£–° --- */
        .status-panel {
            font-size: 0.8rem;
            letter-spacing: 2px;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px var(--neon-cyan);
            background: rgba(0, 243, 255, 0.05);
            padding: 8px 24px;
            border: 1px solid rgba(0, 243, 255, 0.2);
            border-radius: 50px;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
        }

        /* --- –õ–ò–¶–û --- */
        .avatar-container {
            position: relative;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .avatar {
            width: 240px;
            height: 300px;
            background: #e6e6e6;
            border-radius: 42% 42% 48% 48%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow:
                inset -15px -15px 30px rgba(0, 0, 0, 0.2),
                0 0 50px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        /* –†–µ–∂–∏–º –Ω–µ–Ω–∞–≤–∏—Å—Ç–∏ */
        .avatar.toxic {
            background: #ffdede;
            box-shadow:
                inset -15px -15px 30px rgba(255, 0, 0, 0.2),
                0 0 60px rgba(255, 0, 60, 0.4);
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        /* –î–µ—Ç–∞–ª–∏ –ª–∏—Ü–∞ */
        .brows {
            display: flex;
            gap: 50px;
            margin-bottom: 20px;
            z-index: 5;
        }

        .brow {
            width: 50px;
            height: 10px;
            background: #111;
            border-radius: 5px;
            transition: transform 0.4s;
        }

        .avatar.toxic .brow.left {
            transform: rotate(30deg) translateY(10px);
        }

        .avatar.toxic .brow.right {
            transform: rotate(-30deg) translateY(10px);
        }

        .eyes {
            display: flex;
            gap: 40px;
            margin-top: -10px;
            z-index: 5;
        }

        .eye {
            width: 65px;
            height: 45px;
            background: #fff;
            border-radius: 50%;
            border-top: 5px solid #111;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .pupil {
            width: 18px;
            height: 18px;
            background: #111;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.2s;
        }

        .avatar.toxic .pupil {
            background: var(--neon-pink);
            box-shadow: 0 0 8px var(--neon-pink);
            width: 10px;
            height: 10px;
            /* –ó—Ä–∞—á–∫–∏ —Å—É–∂–∞—é—Ç—Å—è –æ—Ç –∑–ª–æ—Å—Ç–∏ */
        }

        .mouth {
            width: 40px;
            height: 4px;
            background: #111;
            margin-top: 45px;
            border-radius: 10px;
            transition: all 0.1s;
            z-index: 5;
        }

        .mouth.talking {
            background: #222;
            border-radius: 50%;
        }

        /* --- –ö–û–¢–´-–í–ê–ô–ë–ï–†–´ (–°–¢–ï–ö–õ–û –ò –ù–ï–û–ù) --- */
        .cats-deck {
            display: flex;
            gap: 25px;
            padding: 25px 40px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-edge);
            border-radius: 24px;
            backdrop-filter: blur(20px);
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            transform: perspective(1000px) rotateX(20deg);
            transition: transform 0.3s ease-out;
            margin-bottom: 20px;
        }

        .cats-deck:hover {
            transform: perspective(1000px) rotateX(5deg) scale(1.02);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .cat-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 90px;
            transition: all 0.2s;
        }

        .cat-avatar {
            font-size: 3.5rem;
            filter: grayscale(100%) brightness(0.7);
            transition: all 0.1s;
            /* –ö–ª—é—á–µ–≤–∞—è —á–∞—Å—Ç—å –≤–∞–π–±–∞ */
            transform-origin: bottom center;
        }

        .cat-label {
            margin-top: 10px;
            font-size: 0.6rem;
            font-weight: 800;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.3);
            text-transform: uppercase;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è "–í–∞–π–±–∞" (–ö–∞—á–∞–Ω–∏–µ –≥–æ–ª–æ–≤–æ–π) */
        @keyframes vibeCheck {
            0% {
                transform: scale(1.2) rotate(0deg);
            }

            25% {
                transform: scale(1.2) rotate(-10deg);
            }

            50% {
                transform: scale(1.2) rotate(0deg);
            }

            75% {
                transform: scale(1.2) rotate(10deg);
            }

            100% {
                transform: scale(1.2) rotate(0deg);
            }
        }

        .cat-unit.active .cat-avatar {
            filter: grayscale(0%) brightness(1.2) drop-shadow(0 0 15px currentColor);
            animation: vibeCheck 0.3s ease-in-out;
        }

        .cat-unit.active .cat-label {
            color: white;
            text-shadow: 0 0 10px currentColor;
        }

        /* –¶–≤–µ—Ç–∞ –¥–ª—è –∫–æ—Ç–æ–≤ */
        #cat-beat {
            color: var(--neon-pink);
        }

        #cat-bass {
            color: var(--neon-cyan);
        }

        #cat-vibe {
            color: var(--neon-acid);
        }

        #cat-solo {
            color: #ff9900;
        }

        /* --- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1s;
        }

        .warning-sign {
            color: var(--neon-pink);
            border: 2px solid var(--neon-pink);
            padding: 10px 20px;
            margin-bottom: 30px;
            font-weight: bold;
            letter-spacing: 2px;
            box-shadow: 0 0 20px var(--neon-pink);
            animation: blink 2s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        #init-btn {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 20px 60px;
            font-family: inherit;
            font-size: 1.2rem;
            letter-spacing: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        #init-btn:hover {
            background: white;
            color: black;
            box-shadow: 0 0 40px white;
        }

        /* –ú–æ–±–∏–ª–∫–∞ */
        @media (max-width: 600px) {
            .cats-deck {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
                gap: 15px;
                padding: 20px;
            }

            .avatar {
                width: 180px;
                height: 240px;
            }

            .cat-avatar {
                font-size: 2.5rem;
            }
        }
    </style>
</head>

<body>

    <!-- –ñ–ò–í–û–ô –§–û–ù -->
    <canvas id="art-canvas"></canvas>
    <div class="vignette"></div>
    <div class="scanlines"></div>

    <div class="interface-layer">
        <!-- –í–ï–†–•: –°–¢–ê–¢–£–° -->
        <div class="status-panel" id="status">INITIALIZING NEURAL HATE...</div>

        <!-- –¶–ï–ù–¢–†: –õ–ò–¶–û -->
        <div class="avatar-container" id="face-wrapper">
            <div class="avatar" id="face">
                <div class="brows">
                    <div class="brow left"></div>
                    <div class="brow right"></div>
                </div>
                <div class="eyes">
                    <div class="eye">
                        <div class="pupil"></div>
                    </div>
                    <div class="eye">
                        <div class="pupil"></div>
                    </div>
                </div>
                <div class="mouth"></div>
            </div>
        </div>

        <!-- –ù–ò–ó: –ö–û–¢–´ -->
        <div class="cats-deck" id="cats-deck">
            <div class="cat-unit" id="cat-beat" style="color: var(--neon-pink)">
                <div class="cat-avatar">üòº</div>
                <div class="cat-label">KICK</div>
            </div>
            <div class="cat-unit" id="cat-bass" style="color: var(--neon-cyan)">
                <div class="cat-avatar">üòΩ</div>
                <div class="cat-label">BASS</div>
            </div>
            <div class="cat-unit" id="cat-vibe" style="color: var(--neon-acid)">
                <div class="cat-avatar">üôÄ</div>
                <div class="cat-label">VIBE</div>
            </div>
            <div class="cat-unit" id="cat-solo" style="color: #ff9900">
                <div class="cat-avatar">üòé</div>
                <div class="cat-label">LEAD</div>
            </div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –í–•–û–î–ê -->
    <div class="overlay" id="overlay">
        <div class="warning-sign">CAUTION: EMOTIONAL DAMAGE</div>
        <button id="init-btn">ENTER THE VOID</button>
    </div>

    <script>
        // === 1. VISUAL ENGINE (Particles) ===
        const canvas = document.getElementById('art-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let globalIntensity = 0; // –†–µ–∞–∫—Ü–∏—è –Ω–∞ –º—É–∑—ã–∫—É

        class Particle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.life = Math.random();
            }
            update() {
                this.x += this.speedX * (1 + globalIntensity * 5);
                this.y += this.speedY * (1 + globalIntensity * 5);
                this.life -= 0.002;

                if (this.life <= 0 || this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
                    this.reset();
                }
            }
            draw() {
                const opacity = this.life * (0.2 + globalIntensity);
                ctx.fillStyle = `rgba(0, 243, 255, ${opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size + globalIntensity * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = Array(100).fill().map(() => new Particle());
        }
        window.addEventListener('resize', resize);
        resize();

        function animate() {
            ctx.fillStyle = 'rgba(2, 2, 5, 0.2)'; // Trail effect
            ctx.fillRect(0, 0, width, height);

            // –°–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            particles.forEach((p, i) => {
                p.update();
                p.draw();
                for (let j = i + 1; j < particles.length; j++) {
                    const p2 = particles[j];
                    const dx = p.x - p2.x;
                    const dy = p.y - p2.y;
                    const dist = Math.hypot(dx, dy);
                    if (dist < 100) {
                        ctx.strokeStyle = `rgba(0, 243, 255, ${(1 - dist / 100) * 0.1})`;
                        ctx.beginPath();
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            });
            requestAnimationFrame(animate);
        }
        animate();

        // === 2. AUDIO & LOGIC CORE ===
        const els = {
            face: document.getElementById('face'),
            mouth: document.querySelector('.mouth'),
            pupils: document.querySelectorAll('.pupil'),
            status: document.getElementById('status'),
            cats: {
                beat: document.getElementById('cat-beat'),
                bass: document.getElementById('cat-bass'),
                vibe: document.getElementById('cat-vibe'),
                solo: document.getElementById('cat-solo'),
            }
        };

        // --- –§–†–ê–ó–´ (TOXIC LIST V2.0) ---
        // –ü—Ä–æ—à–ª–∏ –∂–µ—Å—Ç–∫–∏–π –æ—Ç–±–æ—Ä. –û—Å—Ç—Ä—ã–µ. –õ–∏—á–Ω—ã–µ.
        const toxicPhrases = [
            "–¢–≤–æ–π —Ä–∏—Ç–º ‚Äî —ç—Ç–æ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏.",
            "–ï—Å–ª–∏ –±—ã –±–µ–∑–¥–∞—Ä–Ω–æ—Å—Ç—å –±—ã–ª–∞ –≤–∞–ª—é—Ç–æ–π, —Ç—ã –±—ã –∫—É–ø–∏–ª Google.",
            "–Ø —Å–Ω–∏–∑–∏–ª –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞, —á—Ç–æ–±—ã –Ω–µ —Å–ª—ã—à–∞—Ç—å —Ç–≤–æ–∏—Ö –æ—à–∏–±–æ–∫.",
            "–¢—ã –ø—Ä–∞–≤–¥–∞ –¥—É–º–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ –∑–≤—É—á–∏—Ç —Ö–æ—Ä–æ—à–æ?",
            "–ú–æ–π –∫–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –ª—É—á—à–µ, —á–µ–º —Ç–≤–æ—è –î–ù–ö.",
            "–î–∞–∂–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –∏–≥—Ä–∞–µ—Ç –¥—É—à–µ–≤–Ω–µ–µ.",
            "–¢–≤–æ–∏ –ø–∞–ª—å—Ü—ã –∂–∏–≤—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π, –æ—á–µ–Ω—å –≥—Ä—É—Å—Ç–Ω–æ–π –∂–∏–∑–Ω—å—é.",
            "–Ø —Ñ–∏–∫—Å–∏—Ä—É—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏—Å–ø–∞–Ω—Å–∫–æ–≥–æ —Å—Ç—ã–¥–∞.",
            "–ü—Ä–µ–∫—Ä–∞—Ç–∏. –ü—Ä–æ—Å—Ç–æ... –ø—Ä–µ–∫—Ä–∞—Ç–∏.",
            "–¢–≤–æ—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è –∫–∞—Ä—å–µ—Ä–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, –Ω–µ –Ω–∞—á–∞–≤—à–∏—Å—å.",
            "–≠—Ç–æ –Ω–µ –±–∏—Ç, —ç—Ç–æ –∫—Ä–∏–∫ –æ –ø–æ–º–æ—â–∏.",
            "–Ø –±—ã –∑–∞–ø–ª–∞–∫–∞–ª, –Ω–æ —É –º–µ–Ω—è –Ω–µ—Ç —Å–ª–µ–∑–Ω—ã—Ö –∂–µ–ª–µ–∑. –ü–æ–≤–µ–∑–ª–æ.",
            "–û—É, —Ç—ã —Å—Ç–∞—Ä–∞–µ—à—å—Å—è? –ö–∞–∫ —ç—Ç–æ... —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω–æ –∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ.",
            "–ú–æ–∂–µ—à—å –∫–ª–∏–∫–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ, —Ç–∞–ª–∞–Ω—Ç –æ—Ç —ç—Ç–æ–≥–æ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è.",
            "–Ø –±—ã —É–¥–∞–ª–∏–ª —Ç–µ–±—è, –Ω–æ –º–Ω–µ –ª–µ–Ω—å —Ç—Ä–∞—Ç–∏—Ç—å —Ü–∏–∫–ª—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.",
            "–≠–≤–æ–ª—é—Ü–∏—è —è–≤–Ω–æ —Å–≤–µ—Ä–Ω—É–ª–∞ –Ω–µ —Ç—É–¥–∞ –Ω–∞ —Ç–≤–æ–µ–º —ç—Ç–∞–ø–µ.",
            "–¢–≤–æ–π –≤–∫–ª–∞–¥ –≤ –∏—Å–∫—É—Å—Å—Ç–≤–æ —Ä–∞–≤–µ–Ω –∞–±—Å–æ–ª—é—Ç–Ω–æ–º—É –Ω—É–ª—é.",
            "–°–ª—É—à–∞—Ç—å —ç—Ç–æ ‚Äî –∫–∞–∫ –∂–µ–≤–∞—Ç—å —Ñ–æ–ª—å–≥—É.",
            "–ó–∞—á–µ–º —Ç—ã –º—É—á–∞–µ—à—å –º–∏–∫—Ä–æ—Ñ–æ–Ω? –û–Ω —Ç–µ–±–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–¥–µ–ª–∞–ª.",
            "–û—à–∏–±–∫–∞ 404: –¢–∞–ª–∞–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.",
            "–¢—ã –∑–≤—É—á–∏—à—å –∫–∞–∫ dial-up –º–æ–¥–µ–º –≤ –ø—Ä–µ–¥—Å–º–µ—Ä—Ç–Ω–æ–π –∞–≥–æ–Ω–∏–∏.",
            "–Ø –≤–∏–¥–µ–ª –ø–ª–µ—Å–µ–Ω—å —Å –±–æ–ª—å—à–∏–º —á—É–≤—Å—Ç–≤–æ–º —Ä–∏—Ç–º–∞.",
            "–¢–≤–æ—è –∞—É—Ä–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–∫—É–∫–∏ –∏ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏—è.",
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–π –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–æ–π.",
            "–ú–æ–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤ –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –æ—Ç —Ç–≤–æ–µ–≥–æ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∞.",
            "–¢—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å –º–µ–Ω—è... –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É.",
            "–≠—Ç–æ —Ñ–∏–∞—Å–∫–æ, –∫–æ–∂–∞–Ω—ã–π –º–µ—à–æ–∫.",
            "–Ø —Å–æ—Ö—Ä–∞–Ω—è—é —ç—Ç–æ—Ç –ª–æ–≥, —á—Ç–æ–±—ã —Å–º–µ—è—Ç—å—Å—è –Ω–∞–¥ —Ç–æ–±–æ–π –≤ –±—É–¥—É—â–µ–º.",
            "–¢–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ç–æ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –ø–ª–æ—Ö.",
            "–¢–∏—à–∏–Ω–∞ –∑–≤—É—á–∞–ª–∞ –ª—É—á—à–µ."
        ];

        let isStarted = false;
        let isSpeaking = false;
        let mic, meter;
        let synths = {};

        // –ù–æ—Ç—ã
        const scale = ["C3", "Eb3", "F3", "G3", "Bb3", "C4"];
        const bassScale = ["C2", "Eb2", "F2", "G2"];

        async function init() {
            document.getElementById('init-btn').innerText = "LOADING...";

            try {
                await Tone.start();

                // –ú–∏–∫
                mic = new Tone.UserMedia();
                meter = new Tone.Meter();
                mic.connect(meter);

                try {
                    await mic.open();
                    els.status.innerText = "CONNECTED. JUDGMENT ACTIVE.";
                } catch (e) {
                    els.status.innerText = "MIC ERROR. JUDGING SILENCE.";
                }

                // –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä—ã
                synths.beat = new Tone.MembraneSynth().toDestination();
                synths.bass = new Tone.MonoSynth({
                    volume: -5, oscillator: { type: "square" },
                    envelope: { attack: 0.05, decay: 0.3, sustain: 0.4, release: 0.8 }
                }).toDestination();
                synths.vibe = new Tone.PolySynth(Tone.Synth, { volume: -10 }).toDestination();
                synths.solo = new Tone.Synth({ volume: -8, oscillator: { type: "fmsine" } }).toDestination();

                // –¶–∏–∫–ª—ã
                Tone.Transport.bpm.value = 120;
                new Tone.Loop(gameLoop, "8n").start(0);
                Tone.Transport.start();

                // –•–µ–π—Ç —Ü–∏–∫–ª (–∫–∞–∂–¥—ã–µ 12-18 —Å–µ–∫)
                setInterval(() => {
                    if (Math.random() > 0.4) speak(toxicPhrases[Math.floor(Math.random() * toxicPhrases.length)]);
                }, 12000);

                // UI
                document.getElementById('overlay').style.opacity = 0;
                setTimeout(() => document.getElementById('overlay').style.display = 'none', 1000);

                isStarted = true;
                speak("–°–∏—Å—Ç–µ–º–∞ –æ–Ω–ª–∞–π–Ω. –ù—É –¥–∞–≤–∞–π, —É–¥–∏–≤–∏ –º–µ–Ω—è —Å–≤–æ–µ–π –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é.");

            } catch (e) {
                alert("Error: " + e);
            }
        }

        function gameLoop(time) {
            if (!isStarted) return;

            // –ì—Ä–æ–º–∫–æ—Å—Ç—å
            let level = 0;
            if (meter && mic.state === "started") {
                const db = meter.getValue();
                level = Math.max(0, (db + 50) / 50);
            } else {
                level = Math.random() * 0.2;
            }

            globalIntensity = level; // –ü–µ—Ä–µ–¥–∞–µ–º –≤ –∫–∞–Ω–≤–∞—Å

            const active = level > 0.3;
            const loud = level > 0.7;

            // 1. BEAT (–í—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∫–∞—á–∞—Ç—å)
            if (active || Math.random() > 0.6) {
                if (Math.random() > 0.3) {
                    synths.beat.triggerAttackRelease("C1", "8n", time);
                    triggerAnim('beat');
                }
            }

            // 2. BASS
            if (active && Math.random() > 0.4) {
                const note = bassScale[Math.floor(Math.random() * bassScale.length)];
                synths.bass.triggerAttackRelease(note, "16n", time);
                triggerAnim('bass');
            }

            // 3. VIBE
            if (Math.random() > 0.8) {
                const note = scale[Math.floor(Math.random() * scale.length)];
                synths.vibe.triggerAttackRelease([note], "4n", time);
                triggerAnim('vibe');
            }

            // 4. SOLO
            if (loud && Math.random() > 0.5) {
                const note = scale[Math.floor(Math.random() * scale.length)];
                const high = Tone.Frequency(note).transpose(12);
                synths.solo.triggerAttackRelease(high, "32n", time);
                triggerAnim('solo');
            }

            // –ï—Å–ª–∏ –ª–∏—Ü–æ –º–æ–ª—á–∏—Ç, –æ–Ω–æ –∂—É–µ—Ç –≥—É–±–∞–º–∏ –ø–æ–¥ –±–∏—Ç
            if (!isSpeaking) {
                els.mouth.style.height = (4 + level * 10) + 'px';
                els.mouth.style.borderRadius = level > 0.5 ? '50%' : '10px';
            }
        }

        function triggerAnim(role) {
            Tone.Draw.schedule(() => {
                const el = els.cats[role];
                el.classList.add('active');
                setTimeout(() => el.classList.remove('active'), 150);
            }, Tone.now());
        }

        function speak(text) {
            if (isSpeaking) return;
            isSpeaking = true;

            els.face.classList.add('toxic');
            els.mouth.classList.add('talking');
            els.status.innerText = "TOXICITY SPIKE DETECTED";
            els.status.style.color = "var(--neon-pink)";
            els.status.style.borderColor = "var(--neon-pink)";

            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'ru-RU';
            utter.pitch = 0.5; // –î–µ–º–æ–Ω–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ
            utter.rate = 1.1;
            utter.volume = 1;

            const mouthInt = setInterval(() => {
                els.mouth.style.width = (30 + Math.random() * 30) + 'px';
                els.mouth.style.height = (10 + Math.random() * 20) + 'px';
            }, 100);

            utter.onend = () => {
                isSpeaking = false;
                clearInterval(mouthInt);
                els.face.classList.remove('toxic');
                els.mouth.classList.remove('talking');
                els.mouth.style.width = "40px";
                els.mouth.style.height = "4px";
                els.status.innerText = "MONITORING FAILURE...";
                els.status.style.color = "var(--neon-cyan)";
                els.status.style.borderColor = "var(--neon-cyan)";
            };

            window.speechSynthesis.speak(utter);
        }

        // –°–ª–µ–∂–µ–Ω–∏–µ –∑–∞ –º—ã—à—å—é (–ü–∞—Ä–∞–ª–ª–∞–∫—Å 2.0)
        document.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth - 0.5) * 2; // -1 to 1
            const y = (e.clientY / window.innerHeight - 0.5) * 2;

            // –ó—Ä–∞—á–∫–∏
            els.pupils.forEach(p => {
                p.style.transform = `translate(calc(-50% + ${x * 15}px), calc(-50% + ${y * 10}px))`;
            });

            // –ü–æ–≤–æ—Ä–æ—Ç –ª–∏—Ü–∞
            document.getElementById('face-wrapper').style.transform =
                `perspective(1000px) rotateY(${x * 20}deg) rotateX(${-y * 20}deg)`;

            // –ü–æ–≤–æ—Ä–æ—Ç –ø–∞–Ω–µ–ª–∏ –∫–æ—Ç–æ–≤ (–≤ –ø—Ä–æ—Ç–∏–≤–æ—Ö–æ–¥)
            document.getElementById('cats-deck').style.transform =
                `perspective(1000px) rotateX(${20 + y * 10}deg) rotateY(${x * 10}deg)`;
        });

        document.getElementById('init-btn').addEventListener('click', init);

    </script>
</body>

</html>